<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/png" href="./static/images/logo.png">
    <meta name="description" content="happy birthday love">
    <meta name="author" content="">
    <link rel="stylesheet" href="">
    <title>Traffic Optimizer</title>
    <link rel="stylesheet" type="text/css" href="../static/css/styles.css">
    <link href="https://fonts.googleapis.com/css?family=Bitter&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Coda+Caption:800&display=swap" rel="stylesheet">
    <link href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/ui-lightness/jquery-ui.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


    <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" crossorigin="anonymous"></script>
    <style>
        #layoutSidenav_content {
            background: url('../static/images/background3.jpg') no-repeat center center/cover;
            font-family: 'Nunito';
            overflow-x: hidden;
        }


        .head {
            font-size: 60px;
        }

        .card-deck .card {
            background: #333;
            color: #fff;
            opacity: 0.9;
        }

        .card-deck .card:hover {
            background: #777;
        }

        .heading {
            text-align: center;
            color: #fff;
        }


        .heading h1 {
            font-size: 50px;
        }

        .heading span {
            color: black;
        }

    </style>

</head>

<body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand" href="/">Traffic Optimizer</a>
        <!--  <button class="btn btn-link btn-sm order-1 order-lg-0" id="sidebarToggle" href="#"><i class="fas fa-bars"></i></button>
          -->
        <!-- Navbar Search-->
        <!--
            <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
                <div class="input-group">
                    <input class="form-control" type="text" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2" />
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            </form>
            -->
        <!-- Navbar-->
        <!--
            <ul class="navbar-nav ml-auto ml-md-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="userDropdown" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                        <a class="dropdown-item" href="#">Settings</a>
                        <a class="dropdown-item" href="#">Activity Log</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="login.html">Logout</a>
                    </div>
                </li>
            </ul>
            -->
    </nav>
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" href="#">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                        <a class="nav-link active" href="/">
                            <div class="sb-nav-link-icon"><i class="fas fa-traffic-light"></i></div>
                            Traffic Optimizer
                        </a>
                    </div>
                </div>
            </nav>
        </div>
        <div id="layoutSidenav_content">
            <main>
                <div class="heading pt-4">
                    <h1> Traffic<span> Optimizer</span></h1>
                </div>
                <div class="card-deck pt-4 px-2">
                    <div class="card" style="">
                        <img class="card-img-top px-2 py-2" src="{{url_for('router.video_stream_one')}}" alt="" height="300">
                        <div class="card-body">
                            <h5 class="card-title">Signal 1</h5>
                            <p class="card-text">
                                <b>Time alloted to signal: </b><span class="time">--</span> minutes
                            </p>
                        </div>
                    </div>
                    <div class="card">
                        <img class="card-img-top px-2 py-2" src="{{url_for('router.video_stream_two')}}" alt="" height="300">
                        <div class="card-body">
                            <h5 class="card-title">Signal 2</h5>
                            <p class="card-text"><b>Time alloted to signal: </b><span class="time">--</span> minutes</p>
                        </div>
                    </div>
                    <div class="card">
                        <img class="card-img-top px-2 py-2" src="{{url_for('router.video_stream_three')}}" alt="" height="300">
                        <div class="card-body">
                            <h5 class="card-title">Signal 3</h5>
                            <p class="card-text"><b>Time alloted to signal: </b><span class="time">--</span> minutes</p>
                        </div>
                    </div>
                    <div class="card">
                        <img class="card-img-top px-2 py-2" src="{{url_for('router.video_stream_four')}}" alt="" height="300">
                        <div class="card-body">
                            <h5 class="card-title">Signal 4</h5>
                            <p class="card-text"><b>Time alloted to signal: </b><span class="time">--</span> minutes</p>
                        </div>
                    </div>
                </div>
                <div class="card mx-2 mt-4 mb-4">
                    <div class="card-header">
                        <i class="fas fa-chart-area mr-1"></i>
                        Chart
                    </div>
                    <div class="card-body">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
            </main>

        </div>

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {
                labels: ['Signal 1', 'Signal 2', 'Signal 3', 'Signal 4', ],
                datasets: [{
                        label: 'My First dataset',
                        backgroundColor: 'transparent',
                        borderColor: 'rgb(255, 99, 132)',
                        data: [0,0,0,0]
                    },
                    {
                        label: 'My Second dataset',
                        backgroundColor: 'transparent',
                        borderColor: 'rgb(255, 49, 13)',
                        data: [0,0,0,0]
                    }
                ]
            },
        });

        var divider = function(x) {
            return x / 10;
        }

        var ajaxCaller = function() {
            $.ajax({
                type: 'GET',
                url: '/get-signal-time',
                success: function(res) {
                    $('.time').each(function(x) {
                        $(this).text(res["time"][x]);
                    });

                    var timeline = res["time"];
                    var count = res["count"];

                    var datasets = {
                        labels: ['Signal 1', 'Signal 2', 'Signal 3', 'Signal 4', ],
                        datasets: [{
                                label: 'Time Alloted to Signal',
                                backgroundColor: 'transparent',
                                borderColor: 'rgb(255, 99, 132)',
                                data: timeline
                            },
                            {
                                label: 'Traffic count divided by 10',
                                backgroundColor: 'transparent',
                                borderColor: 'rgb(255, 49, 13)',
                                data: count
                            }
                        ]
                    };
                    chart.config.data = datasets;
                    console.log(chart.config);
                    chart.update();
                },
            });
        }

        setInterval(ajaxCaller, 5000);

    </script>
</body>

</html>
